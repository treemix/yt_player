<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Full screen video</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- Styles for Video -->
    <link href="css/video.css" rel="stylesheet">

</head>

<body>

    <section class="full-size-page">

        <div id="top-panel">
            <div id="title-video">Full screen video</div>
            <a id="play-list" href="./playlist.html">
                <svg class="bi bi-list" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M2.5 11.5A.5.5 0 013 11h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4A.5.5 0 013 7h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4A.5.5 0 013 3h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5z"
                        clip-rule="evenodd" />
                </svg>
            </a>
        </div>

        <div id="video-overlay">
            <img id="logo" src="images/logo.png" />
        </div>
        <div class="background-video">
            <div class="foreground-video">
                <div id="player"></div>
            </div>
        </div>

        <div id="bottom-panel">
            <div id="line" onclick="progress (event);">
                <div class="viewed"></div>
                <div id="fader" onclick="alert('fader');"></div>
            </div>
            <div id="controls">
                <button id="play-pause" class="play" onclick="play_pause();">
                    <svg class="bi bi-pause-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M5.5 3.5A1.5 1.5 0 017 5v6a1.5 1.5 0 01-3 0V5a1.5 1.5 0 011.5-1.5zm5 0A1.5 1.5 0 0112 5v6a1.5 1.5 0 01-3 0V5a1.5 1.5 0 011.5-1.5z" />
                    </svg>
                    <svg class="bi bi-play-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 010 1.393z" />
                    </svg>
                </button>
                <button id="next" onclick="player.nextVideo();">
                    <svg class="bi bi-skip-end-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M12 3.5a.5.5 0 01.5.5v8a.5.5 0 01-1 0V4a.5.5 0 01.5-.5z"
                            clip-rule="evenodd" />
                        <path
                            d="M11.596 8.697l-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 010 1.393z" />
                    </svg>
                </button>
                <button id="mute" class="on-mute" onclick="onMute();">
                    <svg class="bi bi-volume-up-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.536 14.01A8.473 8.473 0 0014.026 8a8.473 8.473 0 00-2.49-6.01l-.708.707A7.476 7.476 0 0113.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z" />
                        <path
                            d="M10.121 12.596A6.48 6.48 0 0012.025 8a6.48 6.48 0 00-1.904-4.596l-.707.707A5.483 5.483 0 0111.025 8a5.483 5.483 0 01-1.61 3.89l.706.706z" />
                        <path
                            d="M8.707 11.182A4.486 4.486 0 0010.025 8a4.486 4.486 0 00-1.318-3.182L8 5.525A3.489 3.489 0 019.025 8 3.49 3.49 0 018 10.475l.707.707z" />
                        <path fill-rule="evenodd"
                            d="M6.717 3.55A.5.5 0 017 4v8a.5.5 0 01-.812.39L3.825 10.5H1.5A.5.5 0 011 10V6a.5.5 0 01.5-.5h2.325l2.363-1.89a.5.5 0 01.529-.06z"
                            clip-rule="evenodd" />
                    </svg>
                    <svg class="bi bi-volume-mute-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M6.717 3.55A.5.5 0 017 4v8a.5.5 0 01-.812.39L3.825 10.5H1.5A.5.5 0 011 10V6a.5.5 0 01.5-.5h2.325l2.363-1.89a.5.5 0 01.529-.06zm7.137 1.596a.5.5 0 010 .708l-4 4a.5.5 0 01-.708-.708l4-4a.5.5 0 01.708 0z"
                            clip-rule="evenodd" />
                        <path fill-rule="evenodd"
                            d="M9.146 5.146a.5.5 0 000 .708l4 4a.5.5 0 00.708-.708l-4-4a.5.5 0 00-.708 0z"
                            clip-rule="evenodd" />
                    </svg>
                </button>

                <div id="time"><span class="current">00:00</span>/<span class="total">00:00</span></div>
            </div>
        </div>

    </section>


    <script type="text/javascript" src="https://www.youtube.com/iframe_api"></script>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <script type="text/javascript">
        var play_list = [
            {
                title: "News and Community Spotlight | April 9, 2020 | Unreal Engine",
                id: "EGcTPWXgR_Y"
            },
            {
                title: "News and Community Spotlight | April 2, 2020 | Unreal Engine",
                id: "oxt0HZxgDp8"
            },
            {
                title: "Real-time skills at the University of Hertfordshire | Project Spotlight | Unreal Engine",
                id: "g1iy_BmgUbY"
            },
            {
                title: "News and Community Spotlight | March 26, 2020 | Unreal Engine",
                id: "SvLZP93Sh88"
            },
        ];

        var player;
        var play_pause_status = "play";
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: 'zFwL301vd4A',
                playerVars: {
                    mute: 1,
                    autoplay: 1,
                    loop: 1,
                    controls: 0,
                    showinfo: 0,
                    autohide: 0,
                    enablejsapi: 1,
                    modestbranding: 1,
                    //playlist: 'zFwL301vd4A',
                    vq: 'hd1080'
                },
                allowfullscreen: 1,
                events: {
                    'onStateChange': onPlayerStateChange,
                    'onReady': onPlayerReady,
                    'onError': onError
                }
            });
        }

        function onMute() {
            if (player.isMuted()) {
                jQuery('#mute').removeClass("on-mute").addClass("off-mute");
                player.unMute();

            } else {
                jQuery('#mute').removeClass("off-mute").addClass("on-mute");
                player.mute();
            }

        }

        function play_pause() {
            if (play_pause_status === "play") {
                play_pause_status = "pause";
                jQuery('#play-pause').removeClass("play").addClass("pause");
                player.pauseVideo();

            } else {
                play_pause_status = "play";
                jQuery('#play-pause').removeClass("pause").addClass("play");
                player.playVideo();
            }
        }

        function onError(){
            jQuery('#video-overlay').show();
        }

        function onPlayerStateChange(el) {

            var _index = player.getPlaylistIndex();

            if (el.data === 1) {
                jQuery('#video-overlay').hide();

                
                var _title = play_list[_index].title;
                jQuery('#title-video').html(_title);

                totalTimerDisplay();
            }

            if (el.data === 2 ||  el.data === 0 || el.data === -1) {
                jQuery('#video-overlay').show();
                
            }

        }

        // Обработчик готовность
        function onPlayerReady(event) {
            player = event.target;
            iframe = document.getElementById('player');

            loadPlaylistVideoIds();


            updateTimerDisplay();
            updateProgressBar();

            time_update_interval = setInterval(function () {
                updateTimerDisplay();
                updateProgressBar();
            }, 100);


        }

        function getUrlID() {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const _id = urlParams.get('id');
            return _id;
        }

        /*Загрузить плейлист*/
        function loadPlaylistVideoIds() {
            var _play_list = [];

            var _index = 0;
            const _get_id = getUrlID();

            play_list.forEach((item, index) => {
                _play_list.push(item.id);
                if (_get_id === item.id) {
                    _index = index;
                }
            });


            player.loadPlaylist({
                'playlist': _play_list,
                'listType': 'playlist',
                'index': _index,
                'startSeconds': 0,
                'suggestedQuality': 'hd1080'
            });

            player.setLoop(true);
            
        }

        function totalTimerDisplay() {
            jQuery('#time').find(".total").html(formatTime(player.getDuration()));
        }

        // Обновляем время на панельке - счетчик
        function updateTimerDisplay() {
            jQuery('#time').find(".current").html(formatTime(player.getCurrentTime()));
        }

        /*Формат времени*/
        function formatTime(time) {
            time = Math.round(time);
            var minutes = Math.floor(time / 60),
                seconds = time - minutes * 60;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            return minutes + ":" + seconds;
        }

        // Обновляем прогресс
        function updateProgressBar() {

            var line_width = jQuery('#line').width();
            var persent = (player.getCurrentTime() / player.getDuration());
            jQuery('.viewed').css('width', persent * line_width);
            per = persent * 100;
            jQuery('#fader').css('left', per + '%');
        }

        /*Линия прогресса*/
        function progress(event) {

            var line_width = jQuery('#line').width();
            // положение элемента
            var pos = jQuery('#line').offset();
            var elem_left = pos.left;
            // положение курсора внутри элемента
            var Xinner = event.pageX - elem_left;
            var newTime = player.getDuration() * (Xinner / line_width);
            // Skip video to new time.
            player.seekTo(newTime);
        }
    </script>
</body>

</html>